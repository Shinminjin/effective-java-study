# Item76 - ê°€ëŠ¥í•œ í•œ ì‹¤íŒ¨ ì›ìì ìœ¼ë¡œ ë§Œë“¤ë¼

## **ì‹¤íŒ¨ ì›ìì„±(Failure Atomicity)**

> í˜¸ì¶œëœ ë©”ì†Œë“œê°€ ì‹¤íŒ¨í•˜ë”ë¼ë„ í•´ë‹¹ ê°ì²´ëŠ” ë©”ì„œë“œ í˜¸ì¶œ ì „ ìƒíƒœë¥¼ ìœ ì§€í•´ì•¼ í•œë‹¤.

- ìœ„ì™€ ê°™ì€ íŠ¹ì„±ì„ ì‹¤íŒ¨ ì›ìì„±ì´ë¼ê³  í•œë‹¤.
- ì‹¤íŒ¨ ì›ìì„±ì€ ì‹œìŠ¤í…œì˜ ì•ˆì •ì„±, ì„±ëŠ¥, ì‹ ë¢°ì„±ì„ í–¥ìƒì‹œí‚¤ëŠ”ë° í•„ìˆ˜ì ì´ë‹¤.

## **ë©”ì„œë“œ ì‹¤íŒ¨ ì›ìì ìœ¼ë¡œ ë§Œë“œëŠ” ë°©ë²•**

### **ë°©ë²• 1 : ë¶ˆë³€ ê°ì²´ë¡œ ì„¤ê³„í•˜ê¸° - *item17***

```java
public class String {
    ...
    public String substring(int beginIndex, int endIndex) {
        int length = length();
        checkBoundsBeginEnd(beginIndex, endIndex, length);
        int subLen = endIndex - beginIndex;
        if (beginIndex == 0 && endIndex == length) {
            return this;
        }
        return isLatin1() ? StringLatin1.newString(value, beginIndex, subLen)
                          : StringUTF16.newString(value, beginIndex, subLen);
    }
    ...
}
```
- ë¶ˆë³€ ê°ì²´ì˜ ìƒíƒœëŠ” ìƒì„± ì´í›„ ì ˆëŒ€ ë³€í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ì‹¤íŒ¨ ì›ìì ì´ë‹¤.
- ì¦‰, ê¸°ì¡´ ê°ì²´ê°€ ë¶ˆì•ˆì •í•œ ìƒíƒœì— ë¹ ì§€ëŠ” ì¼ì€ ìƒê¸°ì§€ ì•ŠëŠ”ë‹¤.

### **ë°©ë²• 2 : ë§¤ê°œë³€ìˆ˜ ìœ íš¨ì„± ê²€ì‚¬ - *item 49***

ì‘ì—… ìˆ˜í–‰ì— ì•ì„œ ë§¤ê°œë³€ìˆ˜ì˜ ìœ íš¨ì„±ì„ ì²´í¬í•œë‹¤.

```java
public Object pop() {
    if (size == 0)
        throw new EmptyStackException();
    
    Object result = elements[--size];
    elements[size] = null; // ë‹¤ ì“´ ì°¸ì¡° í•´ì œ
    return result;
}
```
- ê°ì²´ ë‚´ë¶€ ìƒíƒœê°€ ë³€í•˜ê¸° ì „ì— ì ì¬ì  ì˜ˆì™¸ ê°€ëŠ¥ì„±ì„ ëŒ€ë¶€ë¶„ ê±¸ëŸ¬ë‚¸ë‹¤.

```java
public void add(String key, Object value) {
    if (!(value instanceof Integer))
        throw new ClassCastException(value.toString());
    map.put(key, (Integer) value);
}
```
- ì‹¤íŒ¨í•  ê°€ëŠ¥ì„±ì´ ìˆëŠ” ëª¨ë“  ì½”ë“œë¥¼, ê°ì²´ì˜ ìƒíƒœë¥¼ ë°”ê¾¸ëŠ” ì½”ë“œë³´ë‹¤ ì•ì— ë°°ì¹˜í•˜ëŠ” ë°©ë²•
- TreeMapì— ì›ì†Œë¥¼ ì¶”ê°€í•˜ê¸° ì „ì— ì •ë ¬ì„ ìœ„í•œ '**ì–´ë–¤ ê¸°ì¤€**'ì— ì í•©í•œì§€ ê²€ì‚¬í•˜ì—¬, ì—‰ëš±í•œ íƒ€ì…ì˜ ì›ì†Œë¼ë©´ ClassCastExceptionì„ ë˜ì§€ê²Œ í•œë‹¤.

### **ë°©ë²• 3 : ì„ì‹œ êµ¬ì¡° ì‚¬ìš©**

ê°ì²´ì˜ ì„ì‹œ ë³µì‚¬ë³¸ì—ì„œ ì‘ì—…í•œ ì´í›„, ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ë©´ ì›ë˜ ê°ì²´ì™€ êµì²´í•œë‹¤.

```java
default void sort(Comparator<? super E> c) {
    Object[] a = this.toArray(); // ë°°ì—´ë¡œ ë³€í™˜ 
    Arrays.sort(a, (Comparator) c);
    ListIterator<E> i = this.listIterator();
    for (Object e : a) {
        i.next();
        i.set((E) e);
    } // ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ë©´ ì›ë˜ ê°ì²´ì™€ êµì²´í•œë‹¤
}
```
- ë°ì´í„°ë¥¼ ì„ì‹œ ìë£Œêµ¬ì¡°ì— ì €ì¥í•´ ì‘ì—…í•˜ëŠ”ê²Œ ë” ë¹ ë¥´ë‹¤ë©´ ì ìš©í•˜ê¸° ì¢‹ì€ ë°©ì‹ì´ë‹¤.
- ì •ë ¬ ì‹œ ë°°ì—´ì„ ì‚¬ìš©í•˜ë©´ ì°¸ì¡° ì§€ì—­ì„±ì´ ë†’ì•„ì ¸ ë°˜ë³µë¬¸ì—ì„œì˜ ì›ì†Œ ì ‘ê·¼ì´ í›¨ì”¬ ë¹¨ë¼ì§„ë‹¤.
- ì •ë ¬ì— ì‹¤íŒ¨í•˜ë”ë¼ë„ ì…ë ¥ ìŠ¤íŠ¸ë¦¼ì€ ë³€í•˜ì§€ ì•ŠëŠ” íš¨ê³¼ë„ ì–»ì„ ìˆ˜ ìˆë‹¤.

### **ë°©ë²• 4 : ë³µêµ¬ ì½”ë“œ**

- ì‘ì—… ë„ì¤‘ ë°œìƒí•˜ëŠ” ì‹¤íŒ¨ë¥¼ ê°€ë¡œì±„ëŠ” ë³µêµ¬ì½”ë“œë¥¼ ì‘ì„±í•˜ì—¬ ì‘ì—… ì „ ìƒíƒœë¡œ ë˜ëŒë¦¬ëŠ” ë°©ë²•
- ì£¼ë¡œ ë””ìŠ¤í¬ ê¸°ë°˜ì˜ ë‚´êµ¬ì„±(durability)ì„ ë³´ì¥í•´ì•¼ í•˜ëŠ” ìë£Œêµ¬ì¡°ì— ì“°ì¸ë‹¤.
- ìì£¼ ì“°ì´ëŠ” ë°©ë²•ì€ ì•„ë‹ˆë‹¤.

## **ì‹¤íŒ¨ ì›ìì„± ë³´ì¥ì´ í˜ë“  ê²½ìš° ğŸ¤”**

ì‹¤íŒ¨ ì›ìì„±ì€ ê¶Œì¥ë˜ëŠ” ë•ëª©ì´ì§€ë§Œ í•­ìƒ ë‹¬ì„±í•  ìˆ˜ ìˆëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.

ë˜í•œ ì‹¤íŒ¨ ì›ìì ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤ê³  í•˜ë”ë¼ë„ í•­ìƒ ê·¸ë¦¬í•´ì•¼ í•˜ëŠ” ê±´ ì•„ë‹ˆë‹¤.

**ì˜ˆì‹œ 1 : `ConcurrentModificationException`**

- ë‘ ìŠ¤ë ˆë“œê°€ ë™ê¸°í™” ì—†ì´ ê°™ì€ ê°™ì€ ê°ì²´ë¥¼ ë™ì‹œì— ìˆ˜ì •í•˜ë ¤ê³  í•  ë•Œ ë°œìƒí•œë‹¤.
- ì´ ê²½ìš°,  `ConcurrentModificationException`ì„ ì¡ì•„ëƒˆë‹¤ê³  í•´ì„œ ê·¸ ê°ì²´ê°€ ì—¬ì „íˆ ì“¸ ìˆ˜ ìˆëŠ” ìƒíƒœë¼ê³  ê°€ì •í•˜ë©´ ì•ˆëœë‹¤.

**ì˜ˆì‹œ 2 : `Error`, `AssertionError`**

- ì‹œìŠ¤í…œ ë ˆë²¨ì˜ ë¬¸ì œëŠ” ì¼ë°˜ì ì¸ ë°©ë²•ìœ¼ë¡œ ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤.
- ë”°ë¼ì„œ ì‹¤íŒ¨ ì›ìì„±ì„ ë³´ì¥í•˜ë ¤ëŠ” ì‹œë„ëŠ” ì˜ë¯¸ê°€ ì—†ë‹¤.

> ì‹¤íŒ¨ ì›ìì„±ì„ ì§€í‚¤ì§€ ëª»í•œë‹¤ë©´, ì‹¤íŒ¨ ì‹œ ê°ì²´ ìƒíƒœë¥¼ API ì„¤ëª…ì— ëª…ì‹œí•´ì•¼ í•œë‹¤.
